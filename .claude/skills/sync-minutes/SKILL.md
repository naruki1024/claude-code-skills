---
name: sync-minutes
description: 議事録から仕様書への変更反映を自動化する。/docs/temp の議事録を解析し、/docs/01.specifications と /docs/02.design に反映。既存記載は取り消し線化、変更元を注釈で記録。/sync-minutes コマンドで使用。
---

# 議事録→仕様書同期スキル

定例・打合せの議事録から仕様書への変更を反映するスキル。
変更履歴を保持しながら、追跡可能な形で仕様を更新する。

## 使い方

```
/sync-minutes                    # 全ての未反映議事録を処理
/sync-minutes 20260106_定例.md   # 特定の議事録のみ処理
```

---

## ワークフロー概要

```
Phase 1: 議事録の解析
    ↓ 変更内容の抽出
Phase 2: 変更のマッピング
    ↓ 仕様書のどこに反映するか特定
Phase 3: 仕様書への反映
    ↓ 取り消し線 + 新記載 + 注釈
Phase 4: 反映記録の作成
    ↓ reflection-log.md の更新
Phase 5: 実装影響確認 & Issue化
    ↓ 実装への影響を確認、必要に応じてIssue作成
Phase 6: 議事録の整理
    ↓ 反映済み議事録を /docs/temp/done/ に移動
完了
```

---

## Phase 1: 議事録の解析

`agents/analyze-minutes.md` の仕様に従いTaskを起動する。

**目的**: `/docs/temp/` から議事録を読み込み、仕様変更に該当する内容を抽出

**入力**:
- 対象: `docs/temp/*.md`
- 引数で指定があればそのファイルのみ

**出力**:
- 議事録ファイル名
- 仕様変更に該当するセクション一覧
- 変更の種類（追加/修正/削除/スコープ変更）

**判定基準**:
仕様変更として抽出すべき内容:
- 機能の追加・削除・変更
- MVPスコープの変更
- UIフロー・画面仕様の変更
- ビジネスルールの変更
- 決定事項（「〜に決定」「〜とする」など）

抽出不要な内容:
- 進捗報告
- スケジュール調整
- 検討中の未決事項
- ネクストアクション（TODOリスト）

---

## Phase 2: 変更のマッピング

`agents/map-changes.md` の仕様に従いTaskを起動する。

**目的**: 抽出した変更内容を仕様書のどのセクションに反映するか特定

**入力**:
- Phase 1 の出力（変更内容リスト）
- 仕様書の構造:
  - `/docs/01.specifications/` - 機能仕様書
  - `/docs/02.design/` - 設計ドキュメント

**出力**:
マッピングテーブル:
```
| 議事録の記載 | 反映先ファイル | 反映先セクション | 変更種別 |
|-------------|---------------|----------------|---------|
| プレミアム講座は連載でも単発でも購入可能 | 01.specifications/CanPass_サイト機能概要書_ダイエット版.md | 3-5. プレミアム講座 | 修正 |
```

**注意事項**:
- 反映先が不明確な場合はユーザーに確認
- 複数箇所に影響する変更は全て列挙

---

## Phase 3: 仕様書への反映

`agents/apply-changes.md` の仕様に従いTaskを起動する。

**作業前に読むこと**:
- [references/strikethrough-rules.md](references/strikethrough-rules.md)
- [references/change-annotation.md](references/change-annotation.md)

**目的**: マッピングに従い仕様書を更新

**ルール**:

### 1. 既存記載の取り消し線化
```markdown
# 変更前
視聴期間は90日間。

# 変更後
~~視聴期間は90日間。~~

視聴期間は120日間。

<!-- 変更: 20260106_定例.md -->
```

### 2. 追加の場合
```markdown
# 新規追加
クーポン機能はリリース時点では実装しない。将来的にUTM経由の自動適用を検討。

<!-- 追加: 20260106_定例.md -->
```

### 3. スコープ変更の場合
```markdown
# MVPスコープの変更
~~**MVP対象**~~

**MVP対象外（次フェーズで実装）**

<!-- スコープ変更: 20260106_定例.md -->
```

**チェックポイント**:
- [ ] 既存記載が削除されていない（取り消し線化されている）
- [ ] 変更元の議事録ファイル名がコメントで記載されている
- [ ] マークダウン形式が崩れていない

---

## Phase 4: 反映記録の作成

`agents/create-log.md` の仕様に従いTaskを起動する。

**作業前に読むこと**:
- [references/reflection-log-format.md](references/reflection-log-format.md)

**目的**: `/docs/reflection-log.md` に反映記録を追記

**出力形式**:
```markdown
## 20260106_定例.md

**反映日時**: 2026-01-09

| 反映先 | セクション | 変更種別 |
|--------|----------|---------|
| 01.specifications/CanPass_サイト機能概要書_ダイエット版.md | 3-5. プレミアム講座 | 修正 |
| 02.design/... | ... | 追加 |

**変更概要**:
- プレミアム講座の購入形態を明確化
- クーポン機能をMVP対象外に変更
```

**注意事項**:
- 既に反映済みの議事録は `reflection-log.md` に記録があるためスキップ
- 新規ファイルの場合は作成

---

## 重要な原則

### 1. 情報の保護
**絶対に既存の記載を削除しない**。取り消し線で履歴を残す。

### 2. 追跡可能性
全ての変更に元の議事録ファイル名を記載し、後から「なぜこう変わったか」を追跡できるようにする。

### 3. 反映記録の一元管理
`/docs/reflection-log.md` で「どの議事録が」「どこに」反映されたかを管理し、二重反映を防止。

---

## チェックリスト

### Phase 1完了時
- [ ] 対象の議事録ファイルを特定した
- [ ] 仕様変更に該当する内容を抽出した

### Phase 2完了時
- [ ] 各変更の反映先を特定した
- [ ] 不明確な点はユーザーに確認した

### Phase 3完了時
- [ ] 全ての変更を仕様書に反映した
- [ ] 取り消し線と注釈が正しく記載されている
- [ ] マークダウン形式が崩れていない

### Phase 4完了時
- [ ] reflection-log.md に記録を追加した
- [ ] 反映完了をユーザーに報告した

### Phase 5完了時
- [ ] 実装への影響を確認した
- [ ] 影響レポートをユーザーに報告した
- [ ] Issue化が必要な項目についてユーザー確認を得た
- [ ] 承認された項目のIssueを作成した

### Phase 6完了時
- [ ] 反映済み議事録を `/docs/temp/done/` に移動した
- [ ] 移動完了をユーザーに報告した

---

## Phase 5: 実装影響確認 & Issue化

`agents/check-impl-impact.md` および `agents/create-impl-issue.md` の仕様に従い処理する。

**目的**: 仕様変更が既存実装に影響するかを確認し、必要に応じてIssue化する

### Step 1: 影響範囲の特定

仕様変更の種類に応じて、影響を受ける可能性のある実装箇所を特定:

| 仕様変更の種類 | 影響を受ける可能性のある実装 |
|--------------|--------------------------|
| DB関連 | `webapp/src/db/schema/`、マイグレーション |
| ビジネスロジック | `webapp/src/server/`、`packages/shared/` |
| UI/画面仕様 | `webapp/src/app/`、`webapp/src/features/` |
| 定数・マスタデータ | `webapp/src/constants/`、Seedデータ |
| API仕様 | Server Actions、API Routes |

### Step 2: 既存実装との差分確認

grepやGlob等を使用して、仕様書に記載された値と実装が一致しているか確認する。

**確認観点**:
1. 仕様書の記載と実装が一致しているか
2. 新規実装が必要か（未実装の機能）
3. 既存実装の修正が必要か

### Step 3: 影響レポートの作成・報告

影響の有無をユーザーに報告:

```markdown
## 実装影響レポート

**確認日時**: YYYY-MM-DD

### 影響あり（要対応）

| 仕様変更 | 影響箇所 | 対応種別 | 優先度 |
|---------|---------|---------|-------|
| {変更内容} | {ファイルパス} | 修正/新規 | 高/中/低 |

### 影響なし

| 仕様変更 | 理由 |
|---------|------|
| {変更内容} | 将来実装予定/ドキュメントのみ |
```

### Step 4: Issue化（ユーザー確認後）

**ユーザーに確認する内容**:
- Issue化する項目の選択
- 優先度の確認
- 担当者のアサイン（任意）

**Issue作成時の固定値**:
```bash
REPO_OWNER="zap-cocoloni"
REPO_NAME="canpass-app"
PROJECT_OWNER="zap-cocoloni"
PROJECT_NUMBER="2"
LABELS="spec-change"
```

**Issue作成後**:
- GitHub Project（CanPass #2）に自動追加
- 作成されたIssue URLをユーザーに報告

---

## Phase 6: 議事録の整理

**目的**: 反映済みの議事録を `/docs/temp/done/` に移動し、未処理ファイルと区別する

### 処理内容

```bash
# 反映済み議事録を done フォルダに移動
mkdir -p docs/temp/done
mv docs/temp/{議事録ファイル名} \
   docs/temp/done/
```

### 注意事項

- `done/` フォルダが存在しない場合は作成する
- 複数ファイルを処理した場合は全て移動する
- 移動完了後、ユーザーに報告する

**報告例**:
```
反映済み議事録を移動しました:
- 20260106_定例.md → docs/temp/done/
```
